<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veterinaria MEJORAS - Sistema de Inventario</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="login-container" class="login-container">
        <div class="login-box">
            <h2><i class="fas fa-paw"></i> Veterinaria MEJORAS</h2>
            <p class="login-subtitle">Sistema de Inventario y Ventas</p>
            <input type="email" id="login-email" placeholder="Email" value="admin@mejoras.com">
            <input type="password" id="login-password" placeholder="Contraseña" value="admin123">
            <button id="login-button">Iniciar Sesión</button>
            <div id="login-error" class="error"></div>
            <div class="login-info">
                <p><i class="fas fa-info-circle"></i> <strong>Credenciales de prueba:</strong></p>
                <p>Email: admin@mejoras.com</p>
                <p>Contraseña: admin123</p>
                <p><i class="fas fa-exclamation-triangle"></i> Sistema optimizado - Solo lectura en inventario</p>
            </div>
        </div>
    </div>

    <div id="app-container" class="app-container">
        <div class="container">
            <header class="header">
                <div>
                    <h1><i class="fas fa-paw"></i> Veterinaria MEJORAS</h1>
                    <p class="subtitle">Sistema de Inventario y Ventas - Actualización Incremental</p>
                    <p id="fecha-hoy" class="hora-chile"></p>
                </div>
                <div class="header-buttons">
                    <button id="agregar-venta-btn" class="header-btn primary">
                        <i class="fas fa-plus"></i> Agregar Venta
                    </button>
                    <button id="exportar-excel-btn" class="header-btn success">
                        <i class="fas fa-file-excel"></i> Exportar Excel
                    </button>
                    <button id="recargarInventarioBtn" class="header-btn primary">
                        <i class="fas fa-sync"></i> Actualizar Inventario
                    </button>
                    <button id="inventarioSincronizado" class="header-btn success" style="display: none;">
                        <i class="fas fa-check-circle"></i> Sincronizado
                    </button>
                    <button id="inventarioNoSincronizado" class="header-btn warning" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i> Pendiente
                    </button>
                    <button id="reporte-encargos-btn" class="header-btn warning">
                        <i class="fas fa-clipboard-list"></i> Reporte de Encargos
                    </button>
                    <div class="user-info">
                        <i class="fas fa-user"></i>
                        <span id="current-user"></span>
                    </div>
                    <button id="logout-button" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Salir
                    </button>
                </div>
            </header>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-icon icon-inventory">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Productos en Inventario</h3>
                        <div class="stat-value" id="total-productos">0</div>
                        <div class="hora-chile">Actualizado: <span id="ultima-actualizacion">--:--</span></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon-sales">
                        <i class="fas fa-cash-register"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Ventas de Hoy</h3>
                        <div class="stat-value" id="ventas-hoy">$0.00</div>
                        <div class="hora-chile">Hoy <span id="fecha-hoy-corta"></span></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Stock Bajo (<10 unidades)</h3>
                        <div class="stat-value" id="stock-bajo">0</div>
                        <div class="hora-chile">Requieren atención</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon-update">
                        <i class="fas fa-sync-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Estado del Sistema</h3>
                        <div class="stat-value" id="estado-sistema">Online</div>
                        <div class="hora-chile">Actualización incremental activa</div>
                    </div>
                </div>
            </div>

            <div class="tabs">
                <button id="tab-inventario-btn" class="tab-btn active">
                    <i class="fas fa-boxes"></i> Inventario
                </button>
                <button id="tab-ventas-btn" class="tab-btn">
                    <i class="fas fa-receipt"></i> Ventas
                </button>
            </div>

            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Buscar por código de barras o descripción...">
            </div>

            <div id="tab-inventario" class="tab-content active">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Código Barras</th>
                                <th>Descripción</th>
                                <th>Stock</th>
                                <th>Costo Unitario</th>
                                <th>Precio Venta</th>
                                <th>Última Actualización</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="inventarioBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="tab-ventas" class="tab-content">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Código Barras</th>
                                <th>Cantidad</th>
                                <th>Precio Unitario</th>
                                <th>Descuento</th>
                                <th>Total</th>
                                <th>Descripción</th>
                                <th>Fecha Venta</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="ventasBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>
    
    <div id="offlineBadge" class="offline-badge">
        <i class="fas fa-wifi-slash"></i>
        <span id="offlineCount">0</span> ventas pendientes
    </div>

    <div id="modalInventario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Editar Producto - MEJORAS</h2>
                <button id="close-modal-inventario" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editCodigo">Código de Barras</label>
                    <input type="text" id="editCodigo" class="readonly-input" readonly>
                </div>
                <div class="form-group">
                    <label for="editDescripcion">Descripción del Producto</label>
                    <input type="text" id="editDescripcion">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editCantidad">Cantidad en Stock</label>
                        <input type="number" id="editCantidad" min="0">
                    </div>
                    <div class="form-group">
                        <label for="editCosto">Costo Unitario ($)</label>
                        <input type="number" id="editCosto" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="editPrecio">Precio de Venta ($)</label>
                        <input type="number" id="editPrecio" min="0" step="0.01">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-inventario" class="action-btn btn-cancel">Cancelar</button>
                <button id="save-inventario" class="action-btn btn-save">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <div id="modalVenta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Editar Venta - MEJORAS</h2>
                <button id="close-modal-venta" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editVentaCodigo">Código de Barras</label>
                    <input type="text" id="editVentaCodigo" class="readonly-input" readonly>
                </div>
                <div class="form-group">
                    <label for="editVentaFecha">Fecha y Hora de Venta</label>
                    <input type="text" id="editVentaFecha" class="readonly-input" readonly>
                </div>
                <div class="form-group">
                    <label for="editVentaDescripcion">Descripción del Producto</label>
                    <input type="text" id="editVentaDescripcion">
                    <span class="form-help">Stock actual se muestra en el placeholder</span>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editVentaPrecio">Precio Unitario ($)</label>
                        <input type="number" id="editVentaPrecio" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="editVentaCantidad">Cantidad Vendida</label>
                        <input type="number" id="editVentaCantidad" min="1">
                    </div>
                    <div class="form-group">
                        <label for="editVentaDescuento">Descuento Aplicado ($)</label>
                        <input type="number" id="editVentaDescuento" min="0" step="0.01" value="0">
                    </div>
                </div>
                <div class="form-group">
                    <label for="editVentaTotal">Total de la Venta</label>
                    <input type="text" id="editVentaTotal" class="readonly-input total-display" readonly>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-venta" class="action-btn btn-cancel">Cancelar</button>
                <button id="save-venta" class="action-btn btn-save">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <div id="modalAgregarVenta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Agregar Venta Manual - MEJORAS</h2>
                <button id="close-modal-agregar-venta" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="buscarProducto"><i class="fas fa-search"></i> Buscar Producto</label>
                    <input type="text" id="buscarProducto" class="search-product-input" placeholder="Escribe código de barras o descripción...">
                    <div id="resultadosBusqueda" class="search-results"></div>
                </div>
                
                <div id="infoProducto" class="product-info">
                    <p><strong>Producto seleccionado:</strong></p>
                    <p><strong>Código:</strong> <span id="productoCodigo"></span></p>
                    <p><strong>Nombre:</strong> <span id="productoNombre"></span></p>
                    <p><strong>Stock disponible:</strong> <span id="productoStock"></span> unidades</p>
                    <p><strong>Precio sugerido:</strong> $<span id="productoPrecio"></span></p>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="ventaCantidad">Cantidad a Vender</label>
                        <input type="number" id="ventaCantidad" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="ventaPrecio">Precio Unitario ($)</label>
                        <input type="number" id="ventaPrecio" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="ventaDescuento">Descuento ($)</label>
                        <input type="number" id="ventaDescuento" min="0" step="0.01" value="0">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="ventaDescripcion">Descripción (opcional)</label>
                    <input type="text" id="ventaDescripcion" placeholder="Descripción de la venta...">
                </div>
                
                <div class="venta-total-info">
                    <p><strong>TOTAL DE LA VENTA:</strong></p>
                    <div class="venta-total" id="ventaTotal">$0.00</div>
                    <p class="venta-fecha" id="fechaVentaActual"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-agregar-venta" class="action-btn btn-cancel">Cancelar</button>
                <button id="save-agregar-venta" class="action-btn btn-save">Registrar Venta</button>
            </div>
        </div>
    </div>

    <div id="modalEncargos" class="modal">
        <div class="modal-content modal-wide">
            <div class="modal-header">
                <h2><i class="fas fa-clipboard-list"></i> Reporte de Encargos Pendientes - MEJORAS</h2>
                <button id="close-modal-encargos" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-header-info">
                    <div>
                        <h3>Productos con stock negativo</h3>
                        <p>Estos productos necesitan reposición inmediata</p>
                    </div>
                    <div style="text-align: right;">
                        <h3>Total de encargos</h3>
                        <p style="font-size: 24px; font-weight: bold; color: #dc2626;" id="total-encargos">0</p>
                    </div>
                </div>
                
                <div class="table-scroll">
                    <table class="encargos-table">
                        <thead>
                            <tr>
                                <th>Código de Barras</th>
                                <th>Descripción</th>
                                <th>Unidades Faltantes</th>
                                <th>Costo de Reposición</th>
                            </tr>
                        </thead>
                        <tbody id="lista-encargos">
                        </tbody>
                    </table>
                </div>
                
                <div class="info-box">
                    <h4><i class="fas fa-info-circle"></i> Información importante</h4>
                    <ul>
                        <li>Los productos con stock negativo representan encargos pendientes</li>
                        <li>La inversión total es el costo necesario para reponer el stock</li>
                        <li>Este reporte se actualiza automáticamente</li>
                        <li>Los valores mostrados son costos de reposición, no precios de venta</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-encargos" class="action-btn btn-cancel">Cerrar</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/inventario.js"></script>
    <script src="js/ventas.js"></script>
    <script src="js/offline.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
